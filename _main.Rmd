--- 
title: "Comunidad para el Desarrollo"
author: "Renzo Álvarez Carcheri"
date: "`r Sys.Date()`"
subtitle: 'Análisis de datos con STATA: aplicaciones con encuestas'
site: bookdown::bookdown_site
documentclass: book
bibliography:
- book.bib
- packages.bib
description: |
  Este es un libro que te permitirá comprender aspectos escenciales de la gestión de datos en el Stata con enfásis en el análisis de encuestas.
link-citations: yes
github-repo: "rstudio/bookdown-demo"
---

# Introducción

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports; for example, a math equation $a^2 + b^2 = c^2$.

## Usos

Each **bookdown** chapter is an .Rmd file, and each .Rmd file can contain one (and only one) chapter. A chapter *must* start with a first-level heading: `# A good chapter`, and can contain one (and only one) first-level heading.

Use second-level and higher headings within chapters like: `## A short section` or `### An even shorter section`.

The `index.Rmd` file is required, and is also your first book chapter. It will be the homepage when you render the book.

## Instalación

You can render the HTML version of this example book without changing anything:

1. Find the **Build** pane in the RStudio IDE, and

1. Click on **Build Book**, then select your output format, or select "All formats" if you'd like to use multiple formats from the same book source files.

Or build the book from the R console:

```{r, eval=FALSE}
bookdown::render_book()
```

To render this example to PDF as a `bookdown::pdf_book`, you'll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.org/tinytex/>.

## Entorno

As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in "Preview book", or from the R console:

```{r eval=FALSE}
bookdown::serve_book()
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')

```


## Recomendaciones

<!--chapter:end:index.Rmd-->

# Aspectos básicos

All chapters start with a first-level heading followed by your chapter title, like the line above. There should be only one first-level heading (`#`) per .Rmd file.

## Uso del do-file editor

## Uso del comando Help

# Empezando a programar

## Carga y análisis descriptivo de datos

En Stata podemos cargar datos internos y externos. Los primeros podemos llamarlos a través del comando `help dta_examples`. Al ejecutar este comando, veremos que dispondremos de más de 25 conjuntos de datos los cuales podemos llamar usando el comando `sysuse`. Para los datos externos de formato .dta usaremos el comando `use`, mientras que para otros formatos como .csv, .xls, .xlsx, .dbf, entre otros; se usará el comando `import`.    

### Datos internos

Para este ejemplo, usaremos el conjunto de datos interno "auto" seguido de la opción `clear` ya que nos permite limpiar la memoria de cualquier otro dataset usado previamente. Seguido de ello, usaremos el comando `describe` para que Stata nos brinde una descripción general de dicho dataset.

```{r, include=FALSE}
library(Statamarkdown)
statapath <- "D:/OneDrive - Superintendencia Nacional de Servicios de Saneamiento/Escritorio/Stata16/StataMP-64.exe"
knitr::opts_chunk$set(engine.path=list(stata=statapath))
```

```{stata}
sysuse auto, clear
describe
```

Inmediatamente Stata nos informa que la data esta relacionada con datos asociados a automóviles del año 1978, la cual exhibe 74 observaciones con 12 variables que, al hacer una lectura rápida de la columna de etiquetas de la variable (variable label), están vinculadas a las características físicas de los vehículos tales como: el peso (weight) y el largo (length), así como el espacio de la maletera (trunk) y el espacio libre (headroom). Asimismo, existen variables asociadas al precio (price), millas recorridas por galón (mpg), entre otras. Finalmente, es importante resaltar que de las 12 variables, 11 de ellas son de tipo numérico y solo 1 de tipo texto o cadena. 

Para seguir conociendo este dataset, ahora usaremos el comando `summarize` con la finalidad de que Stata nos muestre los principales estadísticos descriptivos de la data.

```{stata, results='hide'}
summarize
```

```{stata, echo=FALSE}
sysuse auto, clear
summarize
```

La tabla nos muestra estadísticos descriptivos básicos como la media, desviación estándar y los valores mínimos y máximos. Como se observa, estos estadísticos son aplicables solo a variables numéricas, por esa razón el contenido de la tabla para la variable marca (make) esta vacía. Asimismo, podemos utilizar la opción del comando `summarize` denominado `detail` para obtener información estadística adicional como la varianza, el sesgo y la kurtosis, así como una serie de percentiles que nos permitirán realizar un análisis descriptivo más detallado. Empleemos este comando con la variable precio (price):

```{stata, results='hide'}
summarize price, detail
```

```{stata, echo=FALSE}
sysuse auto, clear
summarize price, detail
```

Otro comando que usaremos frecuentemente es el comando `codebook` ya que nos permitirá obtener información complementaria a la antes vista, esta vez sin importar si la variable es número o texto. Utilicemos este comando para la variable de tipo texto llamada marca (make).

```{stata, results='hide'}
codebook make
```

```{stata, echo=FALSE}
sysuse auto, clear
codebook make
```

Como acabamos de ver, el comando `codebook` nos muestra información muy importante para cualquier analista de datos, en particular, sobre los valores únicos (unique values) y valores pérdidos (missing values). En este caso, Stata nos señala que la variable marca (make) tiene 74 valores único y 0/74 missings values. Esto último significa que los autos de la muestra los componen 74 autos de marcas diferentes, de los cuales para el 100% de la muestra se encuentra dicha información.

### Datos externos

Stata puede importar sin ningún problema datos en formato .dta; para cuáles son las posibilidades que tenemos para importar archivos debemos escribir el comando `help import`. La ventana que muestra el Stata permite observar todos los formatos compatibles a importar, por lo que solo bastaría tener claridad de que tipo de formato queremos importar para acceder a la sintaxis y empezar a cargar nuestros datos. Aquí un ejemplo para importar archivos de formato excel.

```{stata, results='hide'}
import excel "ruta del archivo.xlsx", firstrow sheet("Sheet1") clear
```

En el término "ruta del archivo.xlsx" del código debemos ingresar la ruta en la cual tenemos nuestro archivo .xlsx que deseamos importar al Stata. Por su parte, la opción "firstrow" señala al Stata que la primera fila de nuestro archivo excel debe ser considerada como la lista de variables. Finalmente, "sheet()" es una opción para especificar la hoja del libro excel, lo que es sumamente importante cuando manejamos varias hojas dentro de un mismo libro.

Una vez importado el archivo, podemos iniciar nuestro análisis descriptivo que vimos en la sección anterior.

## Tipo de variables y formatos

Profundicemos un poco sobre las variables y formatos ya que son parte fundamental en la gestión de datos. Afortunadamente, en Stata trabajaremos con solo variables de clase númerica y texto por lo que no será muy complejo abordar esta sección.

### Tipos de almacenamiento

Las variables numéricas y textos se almacenarán en la memoria a través de diferentes tipologías. Comenzando por las variables numéricas tenemos los siguientes tipos de almacenamiento: byte, int, long, float y double.

Cada tipología esta directamente relacionado con su tamaño de almacenamiento en términos de "bytes". Así, una variable númerica de tipo "byte" tendrá un peso de 1 "bytes" en la memoria, de modo que este tipo de variable estará usualmente asociada con números de hasta 3 caracteres. 

Podemos obtener ayuda del Stata para conocer las distintas tipologías de variables que se manejan. Así, al escribir el comando `help Data types` podemos observar todas las tipologías tanto para las variables numéricas y texto, las cuales siguen la misma lógica del párrafo anterior.

En cuanto a los formatos, estos son aplicables a las variables numéricas y nos permitirán generar una visualización personalizada de dichas variables. La manera de acceder a toda la caja de formatos será escribiendo el siguiente comando: `help format`.

Es importante señalar que para Stata no es imprescindible que especifiquemos el tipo de almacenamiento y los formatos ya que el Stata establece las establece por defecto. De hecho, podemos gestionar las variables de un dataset sin siquiera colocar alguna línea referida al tipo de almacenamiento y su formato. Por ejemplo, al utilizar el comando `generate edad = 10` estamos creando una nueva variable para un determinado dataset, esta variable tomará el nombre de "edad" y tendrá como valores el número 10. En este caso, no estamos señalandole al Stata explícitamente el tipo de almacenamiento que tendrá esta variable y aún así Stata lo creará. Ahora bien, si revisamos a través del comando `codebook edad` nos mostrará que el tipo de almacenamiento definido por defecto por el Stata es "float". Sin embargo, por los valores que aborda esta variable "edad" es totalmente factible que la variable sea de tipo "byte" en lugar de "float", de manera tal que podemos ahorrarnos algunos bytes en la memoria sin perjudicar la calidad de los datos.




<!--chapter:end:01-intro.Rmd-->

# Explorando la ENAHO{#cross}

Cross-references make it easier for your readers to find and link to elements in your book.

## Uso de encuestas en el análisis de datos

There are two steps to cross-reference any heading:

1. Label the heading: `# Hello world {#nice-label}`. 
    - Leave the label off if you like the automated heading generated based on your heading title: for example, `# Hello world` = `# Hello world {#hello-world}`.
    - To label an un-numbered heading, use: `# Hello world {-#nice-label}` or `{# Hello world .unnumbered}`.

1. Next, reference the labeled heading anywhere in the text using `\@ref(nice-label)`; for example, please see Chapter \@ref(cross). 
    - If you prefer text as the link instead of a numbered reference use: [any text you want can go here](#cross).

## Características de la ENAHO

Figures and tables *with captions* can also be cross-referenced from elsewhere in your book using `\@ref(fig:chunk-label)` and `\@ref(tab:chunk-label)`, respectively.

See Figure \@ref(fig:nice-fig).

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center', fig.alt='Plot with connected points showing that vapor pressure of mercury increases exponentially as temperature increases.'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Don't miss Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(pressure, 10), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

## Descripción inicial de los datos

<!--chapter:end:02-cross-refs.Rmd-->

# Gestión de datos con ENAHO

You can add parts to organize one or more book chapters together. Parts can be inserted at the top of an .Rmd file, before the first-level chapter heading in that same file. 

Add a numbered part: `# (PART) Act one {-}` (followed by `# A chapter`)

Add an unnumbered part: `# (PART\*) Act one {-}` (followed by `# A chapter`)

Add an appendix as a special kind of un-numbered part: `# (APPENDIX) Other stuff {-}` (followed by `# A chapter`). Chapters in an appendix are prepended with letters instead of numbers.

## Gestión del módulo 100

El módulo 100 corresponde al módulo de las "Características de la Vivienda y del Hogar" por lo que inmediatamente iniciamos la programación abriendo el archivo formato .dta denominado "enaho01-2022-100".

```{stata, results='hide'}
cd "ruta del archivo"
use enaho01-2022-100, clear
```

Ahora bien, empezaremos con las variables identificadoras; estas son las variables conglome, vivienda y hogar las cuales describiremos a continuación:

```{stata, results='hide'}
describe conglome vivienda hogar
```

```{stata, echo=FALSE}
use "D:\OneDrive - Superintendencia Nacional de Servicios de Saneamiento\Escritorio\renzo\asesorías\Noemy\data\enaho01-2022-100.dta", clear
describe conglome vivienda hogar
```

El resultado anterior nos muestra que las variables identificadoras son de tipo texto, de 2 a 6 caracteres, que refieren al número de conglomerado, número de selección de la vivienda y número secuencial del hogar. Finalmente, empleados un `codebook` para observar lo valores únicos y los missings values.

```{stata, results='hide'}
codebook conglome vivienda hogar
```

```{stata, echo=FALSE}
use "D:\OneDrive - Superintendencia Nacional de Servicios de Saneamiento\Escritorio\renzo\asesorías\Noemy\data\enaho01-2022-100.dta", clear
codebook conglome vivienda hogar
```

Como observamos, los tres identificadores están presentes para las 44,122 observaciones lo que sugiere que todos las viviendas se encuentran identificadas. Asimismo, existen 5,359 valores únicos de conglomerados; esto nos indica que las 44,122 viviendas de la muestra han sido seleccionadas de tal modo que pertecen a alguno de los 5,359 conglomerados, 649 viviendas y cuentan con algún número secuencial del hogar asignado.

En tal sentido, las variables "conglome", "vivienda" y "hogar" serán una suerte de "documento de identidad" que nos permitirá individualizar a las viviendas. Con la finalidad de efectuar esto último, usamos la función `group()` del comando `egen`, en la que crearemos una variable denominada "id".

```{stata, results='hide'}
egen id = group(conglome vivienda hogar)
```

Luego, corroboramos que esta variable se encuentre dispersa en toda la muestra y que, además, sean valores únicos, por lo que usaremos las funciones `count`.

```{stata, results='hide'}
count if id
```

```{stata, echo=FALSE}
use "D:\OneDrive - Superintendencia Nacional de Servicios de Saneamiento\Escritorio\renzo\asesorías\Noemy\data\enaho01-2022-100.dta", clear
egen id = group(conglome vivienda hogar)
count if id
```

Se muestra que la variable "id" abarca a todas las viviendas y que además, por el comando `isid`, todos los valores de esta variable son únicos. Por lo tanto, cumple con el objetivo de identificar a todas las viviendas de la muestra.

Ahora bien, imaginemos que deseamos enfocarnos solo en información asociada a las características de las viviendas de la muestra, en particular, de los servicios que posee tales: el agua, la luz y el internet, así como el material predominante de dicha vivienda.

Así, inspeccionamos la data con los clásicos comandos de `describe` para localizar las variables de interés, dando como resultado que las variables relevantes son:

```{stata, results='hide'}
describe p110 p111a p1121
```

```{stata, echo=FALSE}
use "D:\OneDrive - Superintendencia Nacional de Servicios de Saneamiento\Escritorio\renzo\asesorías\Noemy\data\enaho01-2022-100.dta", clear
describe p110 p111a p1121
```

## Gestión del módulo 200

## Gestión del módulo 300

## Gestión del módulo 400

## Gestión del módulo 500

## Integrando módulos

<!--chapter:end:03-parts.Rmd-->

# Análisis inferencial

## Revisión del modelos de regresión

Footnotes are put inside the square brackets after a caret `^[]`. Like this one ^[This is a footnote.]. 

## Principales comandos para regresiones

Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>

## Inferencias con factores de expansión

## Aplicación con encuestas

<!--chapter:end:04-citations.Rmd-->

# Gestión con datos de panel ENAHO

## Aspectos a tener en cuenta

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom).


## Comandos para panel de datos

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$
:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

## Aplicación econométrica


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

<!--chapter:end:05-blocks.Rmd-->

# Extra

## Uso de globals y locals

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

## Uso de comandos forvalue y foreach

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

## Almacenamiento y reporte de resultados

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```



<!--chapter:end:06-share.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

